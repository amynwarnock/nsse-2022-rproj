---
title: "NSSE 2022 Analysis [In Progress]"
author: "Amy N. Warnock"
date: "Last updated November 9, 2022"   
output:
  html_document:
    toc: true
    toc_depth: 5
    toc_float: true
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      fig.width = 10,
                      fig.height = 8)

#install.packages("here")
#install.packages("tidyverse")
#install.packages("janitor")
#install.packages("rio")
#install.packages("colorblindr")
#install.packages("scales")
#install.packages("wesanderson")
#install.packages("ggridges")
#install.packages("Rfast")
#install.packages("MASS")
#install.packages("likert")
#install.packages("psych")
#install.packages("haven")
#install.packages("sjPlot")
#install.packages("ggrepel")
#install.packages("cowplot")
#install.packages("remotes")
#remotes::install_github("martinctc/surveytoolbox")
#install.packages("colorspace", repos = "http://R-Forge.R-project.org")
#remotes::install_github("clauswilke/colorblindr")
#install.packages("stringr")
#install.packages("gt")
#install.packages("gtExtras")

library(here)
library(tidyverse)
library(janitor)
library(rio)
library(scales)
library(wesanderson)
library(likert)
library(ggrepel)
library(cowplot)
library(surveytoolbox)
library(colorblindr)
library(stringr)
library(gt)
library(gtExtras)

#library(psych)
#library(sjPlot)
```

### Load Data

```{r load-data}
# load the 2022 NSSE dataset

nsse_orig_full <- import(
  here("data", "NSSE22 Data (UO).sav"), 
  setclass = "tbl_df")

# load demographics from IDR/Cognos (exported 10/14/22 AW)
idr_demo_orig <- import(
  here("data", "2022-10-14c-Cognos_StudentDemographics_ALL_wPIDM.xlsx"), 
  setclass = "tbl_df")

```

### Wrangling

```{r wrangle-nsse}
# NSSE: select variables of interest and recode race/ethnicity, co-curricular engagement

nsse_orig_narrowed <- nsse_orig_full %>% 
  select(studentid, 
         IRclass, 
         IRsex19, 
         IRrace, 
         DDrace,
         DDeconomic, 
         DDreligion,
         DDpolitical,
         QIstudent,
         QIadvisor,
         QIfaculty, 
         QIstaff,
         QIadmin,
         SEacademic,
         SElearnsup,
         SEdiverse,
         SEsocial,
         SEwellness,
         SEnonacad,
         SEactivities,
         SEevents,
         CWPidea,
         CWPclarify,
         CWPrelevant,
         CWPdescribe,
         CWPfeedback,
         CWPfamily,
         CWPhighschool,
         CWPadvisor,
         CWPcoach,
         CWPresearch,
         CWPcocurrR,
         CIV03a19,
         CIV03b19,
         CIV04c19,
         CIV01a19,
         CIV01b19,
         CIV02c19,
         CIV04a19,
         CIV04i19,
         present,
         RIsocietal,
         RIdiverse,
         leader,
         research,
         learncom,
         sbvalued,
         reading,
         pgspeak,
         tmworkhrs,
         tmcocurr) %>% 
  mutate(studentid = as.numeric(studentid),
         tmcocurr_binned = 
           case_when(
             tmcocurr == '1' | tmcocurr == '2' ~ 'Low', 
             tmcocurr == '3' | tmcocurr == '4' ~ 'Moderate', 
             tmcocurr == '5' | tmcocurr == '6' | 
               tmcocurr == '7' | tmcocurr == '8' ~ 'High'),
         tmds = 
           case_when(
             IRrace == '1' | IRrace == '2' | 
               IRrace == '3' | IRrace == '4' |
               IRrace == '5' ~ 'TMDS',
             IRrace == '6' ~ 'Non-TMDS'),
         IRclass = dplyr::recode(IRclass,
                                 `1` = "First Year",
                                 `4` = "Senior")
  )


# create factorized and characterized versions

nsse_fct_wide <- nsse_orig_narrowed %>% 
  factorize()


nsse_chr_wide <- nsse_orig_narrowed %>% 
  characterize()
```

#### Inspecting NSSE dataframes

```{r inspect-nsse}
# orig nsse data that was narrowed to variables of interest
head(nsse_orig_narrowed)

# wide nsse dataset that has been factorized
head(nsse_fct_wide)
str(nsse_fct_wide)

# to swap out variable names with variable labels (i.e., the questions themselves)
# colnames(data_orig) <- sapply(data_orig, function(x) attr(x, "label"))

# create a df containing the var labels
# data_vars_labels <- nsse_orig_full %>% 
#   varl_tb()

# wide nsse dataset that has been characterized
head(nsse_chr_wide)
```

#### Checking that tmds and tmcocurr variables were recoded correctly

```{r check-recoding}

# check the recoded tmcocurr and race/eth variables
ftable(nsse_chr_wide$IRrace, nsse_chr_wide$tmds, exclude = "")
ftable(nsse_chr_wide$tmcocurr, nsse_chr_wide$tmcocurr_binned, exclude = "")
```

#### Pivoting longer for dumbbell graphs and summary tables

```{r wrangle-nsse-pivot-longer}
# pivot longer so that that item names and responses to each item are stored in 2 columns (i.e., one row per student per item response)
nsse_fct_long <- nsse_fct_wide %>% 
  pivot_longer(5:49,
               names_to = "var", 
               values_to = "response") %>% 
  mutate(var_detail = dplyr::recode(var, 
                                    DDrace = "Race/ethnicity",
                                    DDeconomic = "SES",
                                    DDreligion = "Religious beliefs",
                                    DDpolitical = "Political ideology",
                                    QIstudent = "Students",
                                    QIadvisor = "Advisors",
                                    QIfaculty = "Faculty",
                                    QIstaff = "Student services",
                                    QIadmin = "Admin",
                                    SEacademic = "Support for succeeding academically",
                                    SElearnsup = "Using learning support services",
                                    SEdiverse = "Encouraging diverse interactions",
                                    SEsocial = "Opportunities for social inolvement",
                                    SEwellness = "Support for well-being",
                                    SEnonacad = "Help managing school/work/life balance",
                                    SEactivities = "Attending campus activities/events",
                                    SEevents = "Attending social justice events",
                                    present = "Given a course presentation",
                                    RIsocietal = "Connected learning to societal problems or issues",
                                    RIdiverse = "Included diverse perspectives in course discussions or assignments",
                                    leader = "Hold a leadership role in a student organization/group",
                                    research = "Work with faculty on a research project",
                                    learncom = "Participate in a learning community",
                                    CWPidea = "They have a clear idea of career plans",
                                    CWPclarify = "Their experience at UO helped clarify career plans",
                                    CWPrelevant = "Their learning at UO is relevant to career plans",
                                    CWPdescribe = "They can describe what is necessary for career plans",
                                    CWPfeedback = "They have received supportive feedback from faculty/advisors about career plans",
                                    CWPfamily = "Advice from family/friends",
                                    CWPhighschool = "Advice from high school teacher/counselor",
                                    CWPadvisor = "Interactions with faculty/academic advisor",
                                    CWPcoach = "Interactions with career coach/career advisor",
                                    CWPcocurrR = "Co-curricular activities",
                                    CWPresearch = "Researched career interest/potential employer/job market",
                                    CIV03a19 = "Course assignments",
                                    CIV03b19 = "Course discussions",
                                    CIV04a19 = "Informed themselves about campus/local issues",
                                    CIV04c19 = "Discussed campus/local issues with others",
                                    CIV04i19 = "Organized others to work on campus/local issues",
                                    CIV01a19 = "Help people resolve disagreements",
                                    CIV01b19 = "Resolve conflicts involving bias/discrimination/prejudice",
                                    CIV02c19 = "Being an informed and active citizen"
  ))
```

#### Wrangle IDR demographics

```{r wrangle-idr-demographics}

# Cognos demographics dataset: select vars that will be used in these analyses, recode residency status, and create variable for first-generation status

idr_demo <- idr_demo_orig %>% 
  mutate(
    residency = ifelse(RESIDENCY_DESC == "Non-Resident", 
                       "Non-Resident", 
                       "Resident"),
    EDUCATION_LEVEL_DESC2 = na_if(EDUCATION_LEVEL_DESC, 
                                  "Unknown"),
    firstgen = ifelse((EDUCATION_LEVEL_DESC2 == "Bachelors Degree" |  
                         EDUCATION_LEVEL_DESC2 == "Masters Degree" |
                         EDUCATION_LEVEL_DESC2 == "Doctoral Degree"), 
                      "Non-First Gen", 
                      "First Gen")) %>% 
  select(ID,
         PERSON_UID,
         CONFIDENTIALITY_IND,
         residency,
         firstgen) 

# checking that there is one row per stu
# idr_demo_IDn <- idr_demo %>% 
#   group_by(ID) %>% 
#   summarize(n = n())

```

#### Join NSSE and IDR Demos

```{r join-nsse-idr}
# join LONG factorized nsse file with demos from IDR/Cognos

nsse_idr_long <- left_join(nsse_fct_long, 
                           idr_demo,
                           by = c("studentid" = "PERSON_UID"))

# # join WIDE narrowed nsse file with demos from IDR/Cognos
# 
# nsse_idr_wide <- left_join(nsse_orig_narrowed, 
#                            idr_demo,
#                            by = c("studentid" = "PERSON_UID"))


# join WIDE characterized nsse file with demos from IDR/Cognos

nsse_idr_wide_chr <- left_join(nsse_chr_wide, 
                           idr_demo,
                           by = c("studentid" = "PERSON_UID"))

# join WIDE factorized nsse file with demos from IDR/Cognos

nsse_idr_wide_fct <- left_join(nsse_fct_wide, 
                           idr_demo,
                           by = c("studentid" = "PERSON_UID"))

# # FG - overall, 5% missing
# nsse_idr_wide_chr %>% 
#   group_by(IRclass, firstgen) %>% 
#   summarize(n = (n()))
# 
# # TMDS - overall, 13% missing
# nsse_idr_wide_chr %>% 
#   group_by(IRclass, tmds) %>% 
#   summarize(n = (n()))
```

#### Inspecting joined NSSE-IDR dataframes

```{r inspect-joined-files}

# long joined file
head(nsse_idr_long)
str(nsse_idr_long)

# wide joined file
str(nsse_idr_wide_fct)
```

### Functions and Plot Pieces

```{r dumbbell-wrangling-functions-mult}
# DD - Discussions with diverse others
                                
dumbbellprep_dd <- function(data, demographic) {
  data %>% 
    filter(startsWith(var, "DD")) %>% 
    group_by({{demographic}}, 
             IRclass, 
             var, 
             var_detail, 
             response) %>%
    summarize(n = n()) %>% 
    pivot_wider(
      names_from = response,
      values_from = n) %>% 
    mutate(
      total = sum(Never, Sometimes, Often, `Very often`, na.rm = TRUE),
      ovo = sum(Often, `Very often`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'DDrace' ~ '1',
        var == 'DDeconomic' ~ '2',
        var == 'DDreligion' ~ '3',
        var == 'DDpolitical' ~ '4'))
}

# QI - Quality of interactions
dumbbellprep_qi <- function(data, demographic) {
  data %>% 
    filter(startsWith(var, "QI")) %>%
    group_by({{demographic}}, 
             IRclass, 
             var, 
             var_detail, 
             response) %>% 
    summarize(n = n()) %>% 
    pivot_wider(names_from = response,
                values_from = n) %>% 
    mutate(
      total = sum(`1 Poor`, `2`, `3`, 
                  `4`, `5`, `6`, `7 Excellent`, na.rm = TRUE),
      ovo = sum(`6`, `7 Excellent`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'QIstudent' ~ '1',
        var == 'QIadvisor' ~ '2',
        var == 'QIfaculty' ~ '3',
        var == 'QIstaff' ~ '4',
        var == 'QIadmin' ~ '5'))
}


# SE - Social engagement
dumbbellprep_se <- function(data, demographic) {
  data %>%
    filter(startsWith(var, "SE")) %>%
    group_by({{demographic}},
             IRclass,
             var,
             var_detail,
             response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = response,
                values_from = n) %>%
    mutate(
      total = sum(`Very little`, `Some`, 
                  `Quite a bit`, `Very much`, na.rm = TRUE),
      ovo = sum(`Quite a bit`, `Very much`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'SEacademic' ~ '1',
        var == 'SElearnsup' ~ '2',
        var == 'SEdiverse' ~ '3',
        var == 'SEsocial' ~ '4',
        var == 'SEwellness' ~ '5',
        var == 'SEnonacad' ~ '6',
        var == 'SEactivities' ~ '7',
        var == 'SEevents' ~ '8'))
}

# RI - Reflective and integrative learning

dumbbellprep_ri <- function(data, demographic) {
  data %>%
    filter(startsWith(var, "RI")) %>% 
    group_by({{demographic}}, 
             IRclass, 
             var, 
             var_detail, 
             response) %>% 
    summarize(n = n()) %>% 
    pivot_wider(names_from = response,
                values_from = n) %>% 
    mutate(total = sum(`Never`, `Sometimes`, 
                       `Often`, `Very often`, na.rm = TRUE),
           ovo = sum(`Often`, `Very often`, na.rm = TRUE),
           percent = (ovo / total),
           pair = case_when(
             var == 'RIsocietal' ~ '1',
             var == 'RIdiverse' ~ '2'))
}

# HIP - high impact practices
dumbbellprep_hip <- function(data, demographic) {
  data %>%
    filter(var == "leader" |
           var == "research"|
           var == "learncom") %>%
    group_by({{demographic}},
             IRclass,
             var,
             var_detail,
             response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = response,
                values_from = n) %>%
    mutate(
      total = sum(`Have not decided`, `Do not plan to do`, 
                  `Plan to do`, `Done or in progress`, na.rm = TRUE),
      ovo = sum(`Plan to do`, `Done or in progress`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'leader' ~ '1',
        var == 'research' ~ '2',
        var == 'learncom' ~ '3'))
}


# CP - CWP career plans
dumbbellprep_cp <- function(data, demographic) {
  data %>%
    filter(var == "CWPidea" |
           var == "CWPclarify" |
           var == "CWPrelevant" |
           var == "CWPdescribe" |
           var == "CWPfeedback") %>%
    group_by({{demographic}},
             IRclass,
             var,
             var_detail,
             response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = response,
                values_from = n) %>%
    mutate(
      total = sum(`Not at all`, `Very little`, `Some`, 
                  `Quite a bit`, `Very much`, na.rm = TRUE),
      ovo = sum(`Quite a bit`, `Very much`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'CWPidea' ~ '1',
        var == 'CWPclarify' ~ '2',
        var == 'CWPrelevant' ~ '3',
        var == 'CWPdescribe' ~ '4',
        var == 'CWPfeedback' ~ '5'))
}

# CPI - CWP influences on career plans
dumbbellprep_cpi <- function(data, demographic) {
  data %>%
    filter(var == "CWPfamily" |
           var == "CWPhighschool" |
           var == "CWPadvisor" |
           var == "CWPcoach" |
           var == "CWPcocurrR") %>%
    group_by({{demographic}},
             IRclass,
             var,
             var_detail,
             response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = response,
                values_from = n) %>%
    mutate(
      total = sum(`Not at all`, `Very little`, `Some`, 
                  `Quite a bit`, `Very much`, na.rm = TRUE),
      ovo = sum(`Quite a bit`, `Very much`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'CWPfamily' ~ '1',
        var == 'CWPhighschool' ~ '2',
        var == 'CWPadvisor' ~ '3',
        var == 'CWPcoach' ~ '4',
        var == 'CWPcocurrR' ~ '5'))
}

# CIVE - CIV engagement encouragement
dumbbellprep_cive <- function(data, demographic) {
  data %>%
    filter(startsWith(var, "CIV03")) %>%
    group_by({{demographic}},
             IRclass,
             var,
             var_detail,
             response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = response,
                values_from = n) %>%
    mutate(
      total = sum(`Very little`, `Some`, 
                  `Quite a bit`, `Very much`, na.rm = TRUE),
      ovo = sum(`Quite a bit`, `Very much`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'CIV03a19' ~ '1',
        var == 'CIV03b19' ~ '2'))
} 

# CIVL - CIV campus and local issues
dumbbellprep_civl <- function(data, demographic) {
  data %>%
    filter(startsWith(var, "CIV04")) %>% 
    group_by({{demographic}}, 
             IRclass, 
             var, 
             var_detail, 
             response) %>% 
    summarize(n = n()) %>% 
    pivot_wider(names_from = response,
                values_from = n) %>% 
    mutate(total = sum(`Never`, `Sometimes`, 
                       `Often`, `Very often`, na.rm = TRUE),
           ovo = sum(`Often`, `Very often`, na.rm = TRUE),
           percent = (ovo / total),
           pair = case_when(
             var == 'CIV04a19' ~ '1',
             var == 'CIV04c19' ~ '2',
             var == 'CIV04i19' ~ '3'))
}


# CIVCR - CIV conflict resolution
dumbbellprep_civcr <- function(data, demographic) {
  data %>%
    filter(startsWith(var, "CIV01")) %>% 
    group_by({{demographic}}, 
             IRclass, 
             var, 
             var_detail, 
             response) %>% 
    summarize(n = n()) %>% 
    pivot_wider(names_from = response,
                values_from = n) %>% 
    mutate(
      total = sum(`Poor`, `2`, `3`, 
                  `4`, `Excellent`, na.rm = TRUE),
      ovo = sum(`4`, `Excellent`, na.rm = TRUE),
      percent = (ovo / total),
      pair = case_when(
        var == 'CIV01a19' ~ '1',
        var == 'CIV01b19' ~ '2'))
}
```

```{r dumbbell-wrangling-functions-singleitem}

# foundational wrangling for dumbbell plots of single items (i.e., not a group of items as with previous areas of interest)

dumbbellprep_single <- function(data, item, demographic) {
  data %>%
    filter(var == {{item}}) %>%
    group_by({{demographic}},
             IRclass,
             var,
             response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = response,
                values_from = n) %>% 
    rename(demo = {{demographic}})
}
```

```{r dumbbell-wrangling-plot-composites}

dumbbellprepplot_comp <- function(data, comp_title, comp_subtitle, comp_caption) {

a <- data %>% 
  filter(IRsex19 != "Unknown") %>% 
  group_by(IRsex19,
           IRclass) %>% 
  summarize(mean_grp = mean(stu_avg, na.rm = TRUE)) %>% 
      rename(demo = IRsex19)

b <- data %>% 
 group_by(tmds,
           IRclass) %>% 
  summarize(mean_grp = mean(stu_avg, na.rm = TRUE)) %>% 
      rename(demo = tmds) %>% 
  drop_na(demo)

c <- data %>% 
 group_by(firstgen,
           IRclass) %>% 
  summarize(mean_grp = mean(stu_avg, na.rm = TRUE)) %>% 
      rename(demo = firstgen) %>% 
  drop_na(demo)

d <- data %>% 
 group_by(residency,
           IRclass) %>% 
  summarize(mean_grp = mean(stu_avg, na.rm = TRUE)) %>% 
      rename(demo = residency)

bind_rows(a, b,
          c, d) %>% 
  mutate(pair = case_when(
    demo == 'Female' ~ '1',
    demo == 'Male' ~ '2',
    demo == 'Non-TMDS' ~ '3',
    demo == 'TMDS' ~ '4',
    demo == 'First-Gen' ~ '5',
    demo == 'Non-First Gen' ~ '6',
    demo == 'Resident' ~ '7',
    demo == 'Non-Resident' ~ '8')) %>%
  ggplot(aes(x = mean_grp,
             y = reorder(demo, mean_grp))) +
  geom_line(aes(group = pair),
            color = "gray60") +
  geom_point(aes(color = IRclass),
             size = 5,
             alpha = .95,
             stroke = 0) +
  scale_color_manual(values = c_class) + 
  coord_cartesian(xlim = c(0, 4.3)) +
  scale_x_continuous(expand = c(0, 0),
                     breaks = c(0, 1, 2, 3, 4)) +  
  theme_minimal(15) +
  theme(plot.title.position = "plot",
        panel.grid.major.y = element_blank(),
        panel.grid.minor.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "bottom",
        legend.title = element_blank()) +
  labs(title = str_wrap({{comp_title}}),
       subtitle = str_wrap({{comp_subtitle}}),
       y = "",
       x = "",
       caption = str_wrap({{comp_caption}}))
}

```


```{r dumbbell-plot-functions}

# dumbbell v1 (items on y-axis, faceted by FY/SR, color by demo)

dumbbells_mult <- function(data, demographic, c, ttl, sbttl, cap) {
  data %>% 
    ggplot(aes(x = percent, 
               y = reorder(var_detail, percent))) +
    facet_wrap(~ IRclass) +
    geom_line(aes(group = pair), 
              color = "gray60") +
    geom_point(aes(color = {{demographic}}), 
               size = 5, 
               alpha = .95, 
               stroke = 0) +
    coord_cartesian(xlim = c(0, .9)) +
    scale_x_continuous(expand = c(0, 0),
                       breaks = c(.1, .3, .5, .7),
                       labels = scales::percent) +
    scale_color_manual(values = {{c}}) + 
    theme_minimal(15) +
    theme(plot.title.position = "plot",
          panel.grid.major.y = element_blank(),
          panel.grid.minor.y = element_blank(),
          panel.grid.minor.x = element_blank(),
          legend.position = "bottom",
          legend.title = element_blank()) + 
    labs(title = {{ttl}},
         subtitle = str_wrap({{sbttl}}),
         y = "",
         x = "",
         caption = str_wrap({{cap}}))
}


# dumbbell v2 (single item of interest, all student subgroups on on y-axis, color by FY/SR)

dumbbells_single <- function(data, ttl, sbttl, cap) {
  data %>% 
    ggplot(aes(x = percent, 
               y = reorder(demo, percent))) +
    geom_line(aes(group = pair), 
              color = "gray60") +
    geom_point(aes(color = IRclass), 
               size = 5, 
               alpha = .95, 
               stroke = 0) +
    coord_cartesian(xlim = c(0, .9)) +
    scale_x_continuous(expand = c(0, 0),
                       breaks = c(.1, .3, .5, .7),
                       labels = scales::percent) +
    scale_color_manual(values = c_class) + 
    theme_minimal(15) +
    theme(plot.title.position = "plot",
          panel.grid.major.y = element_blank(),
          panel.grid.minor.y = element_blank(),
          panel.grid.minor.x = element_blank(),
          legend.position = "bottom",
          legend.title = element_blank()) + 
    labs(title = {{ttl}},
         subtitle = str_wrap({{sbttl}}),
         y = "",
         x = "",
         caption = str_wrap({{cap}}))
}

```

```{r dumbbell-plot-colors}
# all colors are from the viridis palettes (viridis, magma, plasma, inferno) and are color-blind friendly

c_gender <- c("Male" = "#3e4989", "Female" = "#fb9b06") #purple, orange

c_tmds <- c("TMDS" = "#f5d949", "Non-TMDS" = "#26828e") #yellow, teal
  
c_firstgen <- c("#6ece58","#440154") #green, dark purple
  
c_residency <- c("#365c8d", "#dfe318") #blue, chartreuse

c_class <- c("#8c2369", "#35b779") #magenta, medium green

```

```{r dumbbell-plot-captions}

note_gender <- "Note. Gender categories limited to male and female due to University of Oregon recordkeeping and to protect student privacy and confidentiality."

note_tmds <- "Note. TMDS = Traditionally Marginalized Domestic Students. Race and ethnicity aggregated to protect studenty privacy and confidentiality."

#note_firsgen <- NOT NECESSARY

#note_residency <- NOT NECESSARY

note_all <- "Note. TMDS = Traditionally Marginalized Domestic Students. Race and ethnicity aggregated to protect studenty privacy and confidentiality. Gender categories limited to male and female due to University of Oregon recordkeeping and to protect student privacy and confidentiality."
  
```

```{r dbell-summary-table-generic-function}

# Generic function for prepping data for summary tables that correspond to dumbbell plots.
# To be used with areas that do not have 1, 2, 3, or 5 questions of interest

dbell_sum_tbl_gen <- function(data, items) {
  
  a <- data %>%
    filter(IRsex19 != "Unknown",
           {{items}}) %>%
    group_by(IRsex19,
             IRclass,
             var,
             var_detail,
             response) %>%
    drop_na(IRsex19, response) %>%
    summarize(n = n()) %>%
    ungroup() %>% 
    select(-(var_detail)) %>% 
    pivot_wider(names_from = var,
                values_from = n) %>% 
    rename(demo = IRsex19)
  
  b <- data %>%
    filter({{items}}) %>%
    group_by(tmds,
             IRclass,
             var,
             var_detail,
             response) %>% 
    drop_na(tmds, response) %>%
    summarize(n = n()) %>%
    ungroup() %>% 
    select(-(var_detail)) %>% 
    pivot_wider(names_from = var,
                values_from = n) %>% 
    rename(demo = tmds) 
  
  c <- data %>%
    filter({{items}}) %>%
    group_by(firstgen,
             IRclass,
             var,
             var_detail,
             response) %>% 
    drop_na(firstgen, response) %>%
    summarize(n = n()) %>%
    ungroup() %>% 
    select(-(var_detail)) %>% 
    pivot_wider(names_from = var,
                values_from = n) %>% 
    rename(demo = firstgen) 
  
  d <- data %>%
    filter({{items}}) %>%
    group_by(residency,
             IRclass,
             var,
             var_detail,
             response) %>% 
    drop_na(response) %>%
    summarize(n = n()) %>%
    ungroup() %>% 
    select(-(var_detail)) %>% 
    pivot_wider(names_from = var,
                values_from = n) %>% 
    rename(demo = residency)  
  
  bind_rows(a, b, c, d) %>% 
    replace(is.na(.), 0) %>% 
    pivot_wider(names_from = IRclass,
                values_from = -(1:3))
}
```

```{r dbell-summary-table-1item-function}


dbell_sum_tbl_1 <- function(data, item) {
  
  
  a <- data %>%
    filter(IRsex19 != "Unknown",
           var == {{item}}) %>%
    group_by(IRsex19,
             IRclass,
             response) %>%
    drop_na(IRsex19, response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = IRclass,
                values_from = n) %>% 
    rename(demo = IRsex19)
  
  b <- data %>%
    filter(var == {{item}}) %>%
    group_by(tmds,
             IRclass,
             response) %>%
    drop_na(tmds, response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = IRclass,
                values_from = n) %>% 
    rename(demo = tmds)
  
  c <- data %>%
    filter(var == {{item}}) %>%
    group_by(firstgen,
             IRclass,
             response) %>%
    drop_na(firstgen, response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = IRclass,
                values_from = n) %>% 
    rename(demo = firstgen)
  
  d <- data %>%
    filter(var == {{item}}) %>%
    group_by(residency,
             IRclass,
             response) %>%
    drop_na(response) %>%
    summarize(n = n()) %>%
    pivot_wider(names_from = IRclass,
                values_from = n) %>% 
    rename(demo = residency)
  
  bind_rows(a, b, c, d) %>% 
    replace(is.na(.), 0) %>% 
    group_by(demo) %>%
    mutate(tot_fy = sum(`First Year`),
           tot_sr = sum(Senior)) %>%
    ungroup() %>%
    mutate(pct_fy = `First Year` / tot_fy,
           pct_sr = Senior / tot_sr) 
  # 
  # %>% 
  #   select(-contains("tot"))
}

```

```{r dbell-summary-table-2items-function}

# function for areas w/ 2 questions

dbell_sum_tbl_2 <- function(data, items, 
                                   item1fy, item1sr, 
                                   item2fy, item2sr) {
  
  dbell_sum_tbl_gen({{data}}, {{items}}) %>% 
    group_by(demo) %>%
    mutate(tot_1_fy = sum({{item1fy}}),
           tot_1_sr = sum({{item1sr}}),
           tot_2_fy = sum({{item2fy}}),
           tot_2_sr = sum({{item2sr}})) %>%
    ungroup() %>%
    mutate(pct_1_fy = {{item1fy}} / tot_1_fy,
           pct_1_sr = {{item1sr}} / tot_1_sr,
           pct_2_fy = {{item2fy}} / tot_2_fy,
           pct_2_sr = {{item2sr}} / tot_2_sr)
  
  # %>%
  #   select(-contains("tot")) 
}  
```

```{r dbell-summary-table-3items-function}
# create functions for item areas that have 1, 2, 3, or 5 questions of interest

# function for areas w/ 3 questions
dbell_sum_tbl_3 <- function(data, items, 
                                   item1fy, item1sr, 
                                   item2fy, item2sr, 
                                   item3fy, item3sr) {
  
  dbell_sum_tbl_gen({{data}}, {{items}}) %>% 
    group_by(demo) %>%
    mutate(tot_1_fy = sum({{item1fy}}),
           tot_1_sr = sum({{item1sr}}),
           tot_2_fy = sum({{item2fy}}),
           tot_2_sr = sum({{item2sr}}),
           tot_3_fy = sum({{item3fy}}),
           tot_3_sr = sum({{item3sr}})) %>%
    ungroup() %>%
    mutate(pct_1_fy = {{item1fy}} / tot_1_fy,
           pct_1_sr = {{item1sr}} / tot_1_sr,
           pct_2_fy = {{item2fy}} / tot_2_fy,
           pct_2_sr = {{item2sr}} / tot_2_sr,
           pct_3_fy = {{item3fy}} / tot_3_fy,
           pct_3_sr = {{item3sr}} / tot_3_sr) 
  
  # %>%
  #   select(-contains("tot"))
  }  

```

```{r dbell-summary-table-4items-function}

dbell_sum_tbl_4 <- function(data, items, 
                                   item1fy, item1sr, 
                                   item2fy, item2sr, 
                                   item3fy, item3sr,
                                   item4fy, item4sr) {
  
  dbell_sum_tbl_gen({{data}}, {{items}}) %>% 
    group_by(demo) %>%
    mutate(tot_1_fy = sum({{item1fy}}),
           tot_1_sr = sum({{item1sr}}),
           tot_2_fy = sum({{item2fy}}),
           tot_2_sr = sum({{item2sr}}),
           tot_3_fy = sum({{item3fy}}),
           tot_3_sr = sum({{item3sr}}),
           tot_4_fy = sum({{item4fy}}),
           tot_4_sr = sum({{item4sr}})) %>%
    ungroup() %>%
    mutate(pct_1_fy = {{item1fy}} / tot_1_fy,
           pct_1_sr = {{item1sr}} / tot_1_sr,
           pct_2_fy = {{item2fy}} / tot_2_fy,
           pct_2_sr = {{item2sr}} / tot_2_sr,
           pct_3_fy = {{item3fy}} / tot_3_fy,
           pct_3_sr = {{item3sr}} / tot_3_sr,
           pct_4_fy = {{item4fy}} / tot_4_fy,
           pct_4_sr = {{item4sr}} / tot_4_sr) 
  # 
  # %>%
  #   select(-contains("tot"))
} 

```

```{r dbell-summary-table-5items-function}

# function for areas w/ 5 questions
dbell_sum_tbl_5 <- function(data, items, 
                                   item1fy, item1sr, 
                                   item2fy, item2sr, 
                                   item3fy, item3sr,
                                   item4fy, item4sr,
                                   item5fy, item5sr) {
  
  dbell_sum_tbl_gen({{data}}, {{items}}) %>% 
    group_by(demo) %>%
    mutate(tot_1_fy = sum({{item1fy}}),
           tot_1_sr = sum({{item1sr}}),
           tot_2_fy = sum({{item2fy}}),
           tot_2_sr = sum({{item2sr}}),
           tot_3_fy = sum({{item3fy}}),
           tot_3_sr = sum({{item3sr}}),
           tot_4_fy = sum({{item4fy}}),
           tot_4_sr = sum({{item4sr}}),
           tot_5_fy = sum({{item5fy}}),
           tot_5_sr = sum({{item5sr}})) %>%
    ungroup() %>%
    mutate(pct_1_fy = {{item1fy}} / tot_1_fy,
           pct_1_sr = {{item1sr}} / tot_1_sr,
           pct_2_fy = {{item2fy}} / tot_2_fy,
           pct_2_sr = {{item2sr}} / tot_2_sr,
           pct_3_fy = {{item3fy}} / tot_3_fy,
           pct_3_sr = {{item3sr}} / tot_3_sr,
           pct_4_fy = {{item4fy}} / tot_4_fy,
           pct_4_sr = {{item4sr}} / tot_4_sr,
           pct_5_fy = {{item5fy}} / tot_5_fy,
           pct_5_sr = {{item5sr}} / tot_5_sr) 
  
  # %>%
  #   select(-contains("tot"))
} 

```

### Part I: Dumbbell Plots

#### Discussions with Diverse Others

```{r dumbbells-dd}

# DD by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_dd(IRsex19) %>% 
  dumbbells_mult(IRsex19,
             c_gender,
             "Discussions with Diverse Others: Gender",
             "Percent of students who \"Often\" or \"Very Often\" had conversations with those differing in...",
             note_gender) 

# DD by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_dd(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
            c_tmds,
            "Discussions with Diverse Others: Race/Ethnicity",
            "Percent of students who \"Often\" or \"Very Often\" had conversations with those differing in...",
            note_tmds)

# DD by first-gen status and class

nsse_idr_long %>% 
  dumbbellprep_dd(firstgen) %>% 
  drop_na(firstgen) %>% 
  dumbbells_mult(firstgen,
            c_firstgen,
            "Discussions with Diverse Others: First-Generation Status",
            "Percent of students who \"Often\" or \"Very Often\" had conversations with those differing in...",
            "")

# DD by res status and class

nsse_idr_long %>% 
  dumbbellprep_dd(residency) %>% 
  dumbbells_mult(residency,
            c_residency,
            "Discussions with Diverse Others: Residency Status",
            "Percent of students who \"Often\" or \"Very Often\" had conversations with those differing in...",
            "")

```

#### Quality of Interactions

```{r dumbbells-qi}
# QI by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_qi(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                 c_gender,
                 "Quality of Interactions: Gender",
                 "Percent of students who rated their interactions with the following groups as a 6 or 7 (on a scale from 1 = \"Poor\" to 7 = \"Excellent\")",
                 note_gender)


# QI by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_qi(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Quality of Interactions: Race/Ethnicity",
                  "Percent of students who rated their interactions with the following groups as a 6 or 7 (on a scale from 1 = \"Poor\" to 7 = \"Excellent\")",
                  note_tmds)

# QI by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_qi(firstgen) %>% 
  drop_na(firstgen) %>% 
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "Quality of Interactions: First-Generation Status",
                  "Percent of students who rated their interactions with the following groups as a 6 or 7 (on a scale from 1 = \"Poor\" to 7 = \"Excellent\")",
                  "")

# QI by residency and class

nsse_idr_long %>% 
  dumbbellprep_qi(residency) %>% 
  dumbbells_mult(residency,
                  c_residency,
                  "Quality of Interactions: Residency Status",
                  "Percent of students who rated their interactions with the following groups as a 6 or 7 (on a scale from 1 = \"Poor\" to 7 = \"Excellent\")",
                  "")
  
```

#### Supportive Environment

```{r dumbbells-se}
# SE by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_se(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                   "Supportive Environment: Gender",
                   "Percent of students who felt \"Quite a Bit\" or \"Very Much\" that UO emphasized...",
                   note_gender)


# SE by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_se(tmds) %>%
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Supportive Environment: Student Race/Ethnicity",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" that UO emphasized...",
                  note_tmds)

# SE by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_se(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                   "Supportive Environment: First-Generation Status",
                   "Percent of students who felt \"Quite a Bit\" or \"Very Much\" that UO emphasized...",
                   "")


# SE by residency and class

nsse_idr_long %>% 
  dumbbellprep_se(residency) %>%
  dumbbells_mult(residency,
                  c_residency,
                  "Supportive Environment: Residency Status",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" that UO emphasized...",
                  "")


```

#### Reflective and Integrative Learning

```{r dumbbells-ri}

# RI by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_ri(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                  "Reflective & Integrative Learning: Gender",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                  note_gender)

# RI by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_ri(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Reflective & Integrative Learning: Race/Ethnicity",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                  note_tmds) 

# RI by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_ri(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "Reflective & Integrative Learning: First-Generation Status",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                   "")


# RI by residency and class

nsse_idr_long %>% 
  dumbbellprep_ri(residency) %>%
  dumbbells_mult(residency,
                  c_residency,
                  "Reflective & Integrative Learning: Residency Status",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                  "")

```

#### High-Impact Practices

```{r dumbbells-hip}

# HIP by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_hip(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                  "High-Impact Practices: Gender",
                  "Percent of students who have or are planning to...",
                  note_gender)

# HIP by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_hip(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "High-Impact Practices: Race/Ethnicity",
                  "Percent of students who have or are planning to...",
                  note_tmds) 

# HIP by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_hip(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "High-Impact Practices: First-Generation Status",
                  "Percent of students who have or are planning to...",
                   "")


# HIP by residency and class

nsse_idr_long %>% 
  dumbbellprep_hip(residency) %>%
  dumbbells_mult(residency,
                 c_residency,
                 "High-Impact Practices: Residency Status",
                 "Percent of students who have or are planning to...",
                 "")

```

#### Perceived Gains: Speaking

```{r dumbbells-pgpspeak}

pg_g <- nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_single("pgspeak", IRsex19)

pg_tmds <- nsse_idr_long %>% 
  dumbbellprep_single("pgspeak", tmds) %>% 
  drop_na(demo)

pg_firstgen <- nsse_idr_long %>% 
  dumbbellprep_single("pgspeak", firstgen) %>% 
  drop_na(demo)

pg_residency <- nsse_idr_long %>% 
  dumbbellprep_single("pgspeak", residency) 

bind_rows(pg_g, pg_tmds,
          pg_firstgen, pg_residency) %>% 
  mutate(
    total = sum(`Very little`, `Some`, 
                `Quite a bit`, `Very much`, na.rm = TRUE),
    ovo = sum(`Quite a bit`, `Very much`, na.rm = TRUE),
    percent = (ovo / total),
    pair = case_when(
      demo == 'Female' ~ '1',
      demo == 'Male' ~ '2',
      demo == 'Non-TMDS' ~ '3',
      demo == 'TMDS' ~ '4',
      demo == 'First-Gen' ~ '5',
      demo == 'Non-First Gen' ~ '6',
      demo == 'Resident' ~ '7',
      demo == 'Non-Resident' ~ '8')) %>% 
  dumbbells_single(
    "Perceived Gains in Verbal Communication",
    "Percent of students who felt \"Quite a bit\" or \"Very much\" that their experience at UO contributed to their skills and development with speaking clearly and effectively" ,
    "Note. insert all notes here")





```

#### Sense of Belonging

```{r dumbbells-sb}

# sense of belonging

sb_g <- nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_single("sbvalued", IRsex19)

sb_tmds <- nsse_idr_long %>% 
  dumbbellprep_single("sbvalued", tmds) %>% 
  drop_na(demo)

sb_firstgen <- nsse_idr_long %>% 
  dumbbellprep_single("sbvalued", firstgen) %>% 
  drop_na(demo)

sb_residency <- nsse_idr_long %>% 
  dumbbellprep_single("sbvalued", residency) 

bind_rows(sb_g, sb_tmds,
          sb_firstgen, sb_residency) %>% 
  mutate(
    total = sum(`Strongly disagree`, `Disagree`, 
                `Agree`, `Strongly agree`, na.rm = TRUE), 
    ovo = sum(`Agree`, `Strongly agree`, na.rm = TRUE),
    percent = (ovo / total),
    pair = case_when(
      demo == 'Female' ~ '1',
      demo == 'Male' ~ '2',
      demo == 'Non-TMDS' ~ '3',
      demo == 'TMDS' ~ '4',
      demo == 'First-Gen' ~ '5',
      demo == 'Non-First Gen' ~ '6',
      demo == 'Resident' ~ '7',
      demo == 'Non-Resident' ~ '8')) %>% 
  dumbbells_single("Sense of Belonging",
                   "Percent of students who \"Agreed\" or \"Strongly agreed\" that they felt valued by UO" ,
                   note_all)

```

#### Academic Challenge: Reading

```{r dumbbells-academic-challenge-reading}
 
# academic challenge: time spent reading of all time spent in preparation for class each week

reading_g <- nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_single("reading", IRsex19)

reading_tmds <- nsse_idr_long %>% 
  dumbbellprep_single("reading", tmds) %>% 
  drop_na(demo)

reading_firstgen <- nsse_idr_long %>% 
  dumbbellprep_single("reading", firstgen) %>% 
  drop_na(demo)

reading_residency <- nsse_idr_long %>% 
  dumbbellprep_single("reading", residency) 

bind_rows(reading_g, reading_tmds,
          reading_firstgen, reading_residency) %>% 
  mutate(
    total = sum(`Very little`, `Some`, 
                `About half`, `Most`, `Almost all`, na.rm = TRUE), 
    ovo = sum(`Most`, `Almost all`, na.rm = TRUE),
    percent = (ovo / total),
    pair = case_when(
      demo == 'Female' ~ '1',
      demo == 'Male' ~ '2',
      demo == 'Non-TMDS' ~ '3',
      demo == 'TMDS' ~ '4',
      demo == 'First-Gen' ~ '5',
      demo == 'Non-First Gen' ~ '6',
      demo == 'Resident' ~ '7',
      demo == 'Non-Resident' ~ '8')) %>%  
  dumbbells_single("Academic Challenge: Reading",
                   "Percent of students who spent \"Most\" or \"Almost all\" of their weekly course preparation timeon assigned reading..." ,
                   note_all)

```

#### Academic Challenge: Course Presentations

```{r dumbbells-academic-challenge-present}

# academic challenge: frequency of course presentations in the past year

present_g <- nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_single("present", IRsex19)

present_tmds <- nsse_idr_long %>% 
  dumbbellprep_single("present", tmds) %>% 
  drop_na(demo)

present_firstgen <- nsse_idr_long %>% 
  dumbbellprep_single("present", firstgen) %>% 
  drop_na(demo)

present_residency <- nsse_idr_long %>% 
  dumbbellprep_single("present", residency) 

bind_rows(present_g, present_tmds,
          present_firstgen, present_residency) %>% 
  mutate(
    total = sum(`Never`, `Sometimes`, `Often`, `Very often`, na.rm = TRUE), 
    ovo = sum(`Often`, `Very often`, na.rm = TRUE),
    percent = (ovo / total),
    pair = case_when(
      demo == 'Female' ~ '1',
      demo == 'Male' ~ '2',
      demo == 'Non-TMDS' ~ '3',
      demo == 'TMDS' ~ '4',
      demo == 'First-Gen' ~ '5',
      demo == 'Non-First Gen' ~ '6',
      demo == 'Resident' ~ '7',
      demo == 'Non-Resident' ~ '8')) %>% 
  dumbbells_single("Academic Challenge: In-Class Presentations", 
                   "Percent of students who \"Often\" or \"Very often\" gave course presentations..." ,
                   note_all)

```

#### Career Plans

```{r dumbbells-cwp-plans}

# CP by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_cp(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                  "Career Plans: Gender",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\"...",
                  note_gender)

# CP by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_cp(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Career Plans: Race/Ethnicity",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\"...",
                  note_tmds) 

# CP by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_cp(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "Career Plans: First-Generation Status",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\"...",
                   "")


# CP by residency and class

nsse_idr_long %>% 
  dumbbellprep_cp(residency) %>%
  dumbbells_mult(residency,
                 c_residency,
                 "Career Plans: Residency Status",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\"...",
                 "")

```                                                

```{r dumbbells-cwp-plans-mean}


cwp_plans_mean <- nsse_idr_long %>% 
  filter(var == "CWPidea" |
           var == "CWPclarify" |
           var == "CWPrelevant" |
           var == "CWPdescribe" |
           var == "CWPfeedback") %>% 
  mutate(resp_num = case_when(response == 'Not at all' ~ '0', 
                              response == 'Very little' ~ '1', 
                              response == 'Some' ~ '2', 
                              response == 'Quite a bit' ~ '3', 
                              response == 'Very much' ~ '4')) %>%  
  group_by(studentid) %>% 
  mutate(stu_avg = mean(as.numeric(resp_num))) %>% # composite not computed if student didn't respond to all items
  ungroup()


dumbbellprepplot_comp(cwp_plans_mean, "Career Plans: Average Score", "", "note tbd")

```


#### Influences on Career Plans

```{r dumbbells-cwp-influences}

# CPI by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_cpi(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                  "Career Plan Influences: Gender",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" their career plans were influenced by...",
                  note_gender)

# CPI by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_cpi(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Career Plan Influences: Race/Ethnicity",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" their career plans were influenced by...",
                 note_tmds) 

# CPI by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_cpi(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "Career Plan Influences: First-Generation Status",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" their career plans were influenced by...",
                 "")


# CPI by residency and class

nsse_idr_long %>% 
  dumbbellprep_cpi(residency) %>%
  dumbbells_mult(residency,
                 c_residency,
                 "Career Plan Influences: Residency Status",
                 "Percent of students who felt \"Quite a Bit\" or \"Very Much\" their career plans were influenced by...",
                 "")


```


```{r dumbbells-cwp-influences-mean}

cwp_inf_mean <- nsse_idr_long %>% 
  filter(var == "CWPfamily" |
           var == "CWPhighschool" |
           var == "CWPadvisor" |
           var == "CWPcoach" |
           var == "CWPcocurrR") %>% 
  mutate(resp_num = case_when(response == 'Not at all' ~ '0', 
                              response == 'Very little' ~ '1', 
                              response == 'Some' ~ '2', 
                              response == 'Quite a bit' ~ '3', 
                              response == 'Very much' ~ '4')) %>%  
  group_by(studentid) %>% 
  mutate(stu_avg = mean(as.numeric(resp_num))) %>% # composite not computed if student didn't respond to all items
  ungroup()


dumbbellprepplot_comp(cwp_inf_mean, "Career Influences: Average Score", "", "note tbd")

```

#### Career Research

```{r dumbbells-cwp-research}

# CWP module: frequency of career preparation activities *during courese*

cresearch_g <- nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_single("CWPresearch", IRsex19)

cresearch_tmds <- nsse_idr_long %>% 
  dumbbellprep_single("CWPresearch", tmds) %>% 
  drop_na(demo)

cresearch_firstgen <- nsse_idr_long %>% 
  dumbbellprep_single("CWPresearch", firstgen) %>% 
  drop_na(demo)

cresearch_residency <- nsse_idr_long %>% 
  dumbbellprep_single("CWPresearch", residency) 

bind_rows(cresearch_g, cresearch_tmds,
          cresearch_firstgen, cresearch_residency) %>% 
  mutate(
    total = sum(`Never`, `Sometimes`, `Often`, `Very often`, na.rm = TRUE), 
    ovo = sum(`Often`, `Very often`, na.rm = TRUE),
    percent = (ovo / total),
    pair = case_when(
      demo == 'Female' ~ '1',
      demo == 'Male' ~ '2',
      demo == 'Non-TMDS' ~ '3',
      demo == 'TMDS' ~ '4',
      demo == 'First-Gen' ~ '5',
      demo == 'Non-First Gen' ~ '6',
      demo == 'Resident' ~ '7',
      demo == 'Non-Resident' ~ '8')) %>% 
  dumbbells_single("Career Research", 
                   "Percent of students who \"Often\" or \"Very often\" researched a career interest, potential employer, or the job market as part of a course at UO..." ,
                   note_all)

```

#### Civic Engagement Encouragement

```{r dumbbells-civ-encouragement}

# CIVE by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_cive(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                  "Civic Engagement Encouragement: Gender",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" enouraged to address important civic issues in...",
                  note_gender)

# CIVE by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_cive(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Civic Engagement Encouragement: Race/Ethnicity",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" enouraged to address important civic issues in...",
                 note_tmds) 

# CIVE by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_cive(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "Civic Engagement Encouragement: First-Generation Status",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" enouraged to address important civic issues in...",
                 "")


# CIVE by residency and class

nsse_idr_long %>% 
  dumbbellprep_cive(residency) %>%
  dumbbells_mult(residency,
                 c_residency,
                 "Civic Engagement Encouragement: Residency Status",
                  "Percent of students who felt \"Quite a Bit\" or \"Very Much\" enouraged to address important civic issues in...",
                 "")

```

```{r dumbbells-civ-encouragement-mean}

civ_encouragement_mean <- nsse_idr_long %>% 
  filter(var == "CIV03a19" |
           var == "CIV03b19") %>% 
  mutate(resp_num = case_when(response == 'Very little' ~ '1', 
                              response == 'Some' ~ '2', 
                              response == 'Quite a bit' ~ '3', 
                              response == 'Very much' ~ '4')) %>%  
  group_by(studentid) %>% 
  mutate(stu_avg = mean(as.numeric(resp_num))) %>% # composite not computed if student didn't respond to all items
  ungroup()


dumbbellprepplot_comp(civ_encouragement_mean, "Civic Engagement Encouragement: Average Score", "", "note tbd")

```

#### Civic Engagement Campus and Local Issues

```{r dumbbells-civ-localissues}

# CIVL by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_civl(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                  c_gender,
                  "Involvement with Campus and Local Issues: Gender",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                  note_gender)

# CIVL by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_civl(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                  c_tmds,
                  "Involvement with Campus and Local Issues: Race/Ethnicity",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                 note_tmds) 

# CIVL by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_civl(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                  c_firstgen,
                  "Involvement with Campus and Local Issues: First-Generation Status",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                 "")


# CIVL by residency and class

nsse_idr_long %>% 
  dumbbellprep_civl(residency) %>%
  dumbbells_mult(residency,
                 c_residency,
                 "Involvement with Campus and Local Issues: Residency Status",
                  "Percent of students who \"Often\" or \"Very Often\"...",
                 "")

```

```{r dumbbells-civ-localissues-mean}

civ_loc_mean <- nsse_idr_long %>% 
  filter(var == "CIV04a19" |
           var == "CIV04c19" |
           var == "CIV04i19") %>% 
  mutate(resp_num = case_when(response == 'Never' ~ '1', 
                              response == 'Sometimes' ~ '2', 
                              response == 'Often' ~ '3', 
                              response == 'Very often' ~ '4')) %>%  
  group_by(studentid) %>% 
  mutate(stu_avg = mean(as.numeric(resp_num))) %>% # composite not computed if student didn't respond to all items
  ungroup()


dumbbellprepplot_comp(civ_loc_mean, "Involvement with Campus and Local Issues: Average Score", "", "note tbd")

```

#### Civic Engagement Conflict Resolution

```{r dumbbells-civ-conflict-res}
# CIVCR by gender and class

nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_civcr(IRsex19) %>% 
  dumbbells_mult(IRsex19,
                 c_gender,
                 "Ability with Conflict Resolution: Gender",
                 "Percent of students who rated their ability with the following as a 4 or 5 (on a scale from 1 = \"Poor\" to 5 = \"Excellent\")",
                 note_gender)

# CIVCR by race/eth and class

nsse_idr_long %>% 
  dumbbellprep_civcr(tmds) %>% 
  drop_na(tmds) %>% 
  dumbbells_mult(tmds,
                 c_tmds,
                 "Ability with Conflict Resolution: Race/Ethnicity",
                 "Percent of students who rated their ability with the following as a 4 or 5 (on a scale from 1 = \"Poor\" to 5 = \"Excellent\")",
                 note_tmds) 

# CIVCR by first-gen and class

nsse_idr_long %>% 
  dumbbellprep_civcr(firstgen) %>% 
  drop_na(firstgen) %>%
  dumbbells_mult(firstgen,
                 c_firstgen,
                 "Ability with Conflict Resolution: First-Generation Status",
                 "Percent of students who rated their ability with the following as a 4 or 5 (on a scale from 1 = \"Poor\" to 5 = \"Excellent\")",
                 "")


# CIVCR by residency and class

nsse_idr_long %>% 
  dumbbellprep_civcr(residency) %>%
  dumbbells_mult(residency,
                 c_residency,
                 "Ability with Conflict Resolution: Residency Status",
                 "Percent of students who rated their ability with the following as a 4 or 5 (on a scale from 1 = \"Poor\" to 5 = \"Excellent\")",
                 "")
```

#### Civic Engagement Institutional Emphasis 

```{r dumbbells-civ-inst-emphasis}

# CIV module: institutional emphasis on being an informed and active citizen

civie_g <- nsse_idr_long %>% 
  filter(IRsex19 != "Unknown") %>% 
  dumbbellprep_single("CIV02c19", IRsex19)

civie_tmds <- nsse_idr_long %>% 
  dumbbellprep_single("CIV02c19", tmds) %>% 
  drop_na(demo)

civie_firstgen <- nsse_idr_long %>% 
  dumbbellprep_single("CIV02c19", firstgen) %>% 
  drop_na(demo)

civie_residency <- nsse_idr_long %>% 
  dumbbellprep_single("CIV02c19", residency) 

bind_rows(civie_g, civie_tmds,
          civie_firstgen, civie_residency) %>% 
  mutate(
    total = sum(`Very little`, `Some`, 
                `Quite a bit`, `Very much`, na.rm = TRUE), 
    ovo = sum(`Quite a bit`, `Very much`, na.rm = TRUE),
    percent = (ovo / total),
    pair = case_when(
      demo == 'Female' ~ '1',
      demo == 'Male' ~ '2',
      demo == 'Non-TMDS' ~ '3',
      demo == 'TMDS' ~ '4',
      demo == 'First-Gen' ~ '5',
      demo == 'Non-First Gen' ~ '6',
      demo == 'Resident' ~ '7',
      demo == 'Non-Resident' ~ '8')) %>% 
  dumbbells_single("Civic Engagement: Institutional Emphasis", 
                   "Percent of students who felt \"Quite a Bit\" or \"Very Much\" that UO emphasized being an informed and active citizen..." ,
                   note_all)



```

### Part 1: Summary Table PREP (Item Responses by Demographic Groups)

```{r dbell-summary-table-dd}

table_dd <- dbell_sum_tbl_4(nsse_idr_long, startsWith(var, "DD"),
                            `DDeconomic_First Year`, DDeconomic_Senior, 
                            `DDpolitical_First Year`, DDpolitical_Senior,
                            `DDrace_First Year`, DDrace_Senior, 
                            `DDreligion_First Year`, DDreligion_Senior)

#export(table_dd, here("data", "table_dd.xlsx"))
```

```{r dbell-summary-table-qi}

table_qi <- dbell_sum_tbl_5(nsse_idr_long, startsWith(var, "QI"),
                            `QIadmin_First Year`, QIadmin_Senior,
                            `QIadvisor_First Year`, QIadvisor_Senior, 
                            `QIfaculty_First Year`, QIfaculty_Senior,
                            `QIstaff_First Year`, QIstaff_Senior,
                            `QIstudent_First Year`, QIstudent_Senior)
```

```{r dbell-summary-table-se}

table_se <- dbell_sum_tbl_gen(nsse_idr_long, startsWith(var, "SE")) %>% 
  group_by(demo) %>% 
  mutate(tot_1_fy = sum(`SEacademic_First Year`),
         tot_1_sr = sum(SEacademic_Senior),
         tot_2_fy = sum(`SEactivities_First Year`),
         tot_2_sr = sum(SEactivities_Senior),
         tot_3_fy = sum(`SEdiverse_First Year`),
         tot_3_sr = sum(SEdiverse_Senior),
         tot_4_fy = sum(`SEevents_First Year`),
         tot_4_sr = sum(SEevents_Senior),
         tot_5_fy = sum(`SElearnsup_First Year`),
         tot_5_sr = sum(SElearnsup_Senior),
         tot_6_fy = sum(`SEnonacad_First Year`),
         tot_6_sr = sum(SEnonacad_Senior),
         tot_7_fy = sum(`SEsocial_First Year`),
         tot_7_sr = sum(SEsocial_Senior),
         tot_8_fy = sum(`SEwellness_First Year`),
         tot_8_sr = sum(SEwellness_Senior)) %>% 
  ungroup() %>% 
  mutate(pct_1_fy = `SEacademic_First Year` / tot_1_fy,
         pct_1_sr = SEacademic_Senior / tot_1_sr,
         pct_2_fy = `SEactivities_First Year` / tot_2_fy,
         pct_2_sr = SEactivities_Senior / tot_2_sr,
         pct_3_fy = `SEdiverse_First Year` / tot_3_fy,
         pct_3_sr = SEdiverse_Senior / tot_3_sr,
         pct_4_fy = `SEevents_First Year` / tot_4_fy,
         pct_4_sr = SEevents_Senior / tot_4_sr,
         pct_5_fy = `SElearnsup_First Year` / tot_5_fy,
         pct_5_sr = SElearnsup_Senior / tot_5_sr,
         pct_6_fy = `SEnonacad_First Year` / tot_6_fy,
         pct_6_sr = SEnonacad_Senior / tot_6_sr,
         pct_7_fy = `SEsocial_First Year` / tot_7_fy,
         pct_7_sr = SEsocial_Senior / tot_7_sr,
         pct_8_fy = `SEwellness_First Year` / tot_8_fy,
         pct_8_sr = SEwellness_Senior / tot_8_sr) %>% 
  select(-contains("tot"))

```

```{r dumbbell-summary-table-ri}

table_ri <- dbell_sum_tbl_2(nsse_idr_long, startsWith(var, "RI"),
                            `RIdiverse_First Year`, RIdiverse_Senior,
                            `RIsocietal_First Year`, RIsocietal_Senior)
```

```{r dumbbell-summary-table-hip}

table_hip <- dbell_sum_tbl_3(nsse_idr_long, (var == "leader" |
                                               var == "research" |
                                               var == "learncom"),
                             `leader_First Year`, leader_Senior, 
                             `learncom_First Year`, learncom_Senior,
                             `research_First Year`, research_Senior)

```

```{r dumbbell-summary-table-nsse-core-singleitems}

table_pgspeak <- dbell_sum_tbl_1(nsse_idr_long, "pgspeak")

table_sbvalued <- dbell_sum_tbl_1(nsse_idr_long, "sbvalued")

table_reading <- dbell_sum_tbl_1(nsse_idr_long, "reading")

table_present <- dbell_sum_tbl_1(nsse_idr_long, "present")

```

```{r dbell-summary-table-cwp}

table_cwp_plans <- dbell_sum_tbl_5(nsse_idr_long, (var == "CWPidea" | 
                                                     var == "CWPclarify" |
                                                     var == "CWPrelevant" |
                                                     var == "CWPdescribe" |
                                                     var == "CWPfeedback"),
                                   `CWPclarify_First Year`, CWPclarify_Senior, 
                                   `CWPidea_First Year`, CWPidea_Senior, 
                                   `CWPdescribe_First Year`, CWPdescribe_Senior,
                                   `CWPfeedback_First Year`, CWPfeedback_Senior,
                                   `CWPrelevant_First Year`, CWPrelevant_Senior)

table_cwp_inf <- dbell_sum_tbl_5(nsse_idr_long, 
                                 (var == "CWPfamily" | 
                                    var == "CWPhighschool" |
                                    var == "CWPadvisor" |
                                    var == "CWPcoach" | 
                                    var == "CWPcocurrR"),
                                 `CWPadvisor_First Year`, CWPadvisor_Senior,
                                 `CWPcoach_First Year`, CWPcoach_Senior,
                                 `CWPcocurrR_First Year`, CWPcocurrR_Senior,
                                 `CWPfamily_First Year`, CWPfamily_Senior, 
                                 `CWPhighschool_First Year`, CWPhighschool_Senior)

table_cwp_research <- dbell_sum_tbl_1(nsse_idr_long, "CWPresearch")



```

```{r dbell-summary-table-civ}
 
table_civ_enc <- dbell_sum_tbl_2(nsse_idr_long, (var == "CIV03a19" | 
                                                           var == "CIV03b19"),
                                         `CIV03a19_First Year`, CIV03a19_Senior,
                                         `CIV03b19_First Year`, CIV03b19_Senior)

table_civ_loc <- dbell_sum_tbl_3(nsse_idr_long, (var == "CIV04a19" |
                                                          var == "CIV04c19" |
                                                          var == "CIV04i19"),
                                        `CIV04a19_First Year`, CIV04a19_Senior, 
                                        `CIV04c19_First Year`, CIV04c19_Senior, 
                                        `CIV04i19_First Year`, CIV04i19_Senior)

table_civ_conf <- dbell_sum_tbl_2(nsse_idr_long, (var == "CIV01a19" | 
                                                           var == "CIV01b19"),
                                         `CIV01a19_First Year`, CIV01a19_Senior,
                                         `CIV01b19_First Year`, CIV01b19_Senior)


table_civ_inst <- dbell_sum_tbl_1(nsse_idr_long, "CIV02c19")

```

### Part I: Summary Tables (Item Responses by Demographic Groups)

#### Discussions with Diverse Others

```{r gt-dbell-summary-table-dd}

table_dd %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>% 
  tab_header(title = "Discussions with Diverse Others",
             subtitle = "During the current school year, how often have you had discussions with people differing in...?") %>% 
  fmt_percent(starts_with("pct")) %>% 
  tab_spanner(
    label = "SES",
    id = 1, 
    columns = c(`DDeconomic_First Year`,
                pct_1_fy)
  ) %>% 
  tab_spanner(
    label = "Political Ideology",
    id = 2, 
    columns = c(`DDpolitical_First Year`,
                pct_2_fy)
  ) %>% 
  tab_spanner(
    label = "Race/Ethnicity",
    id = 3, 
    columns = c(`DDrace_First Year`,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = "Religious Beliefs",
    id = 4, 
    columns = c(`DDreligion_First Year`,
                pct_4_fy)
  ) %>% 
  tab_spanner(
    label = "SES",
    id = 5, 
    columns = c(DDeconomic_Senior,
                pct_1_sr)
  )  %>% 
  tab_spanner(
    label = "Political Ideology",
    id = 6, 
    columns = c(DDpolitical_Senior,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "Race/Ethnicity",
    id = 7, 
    columns = c(DDrace_Senior,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = "Religious Beliefs",
    id = 8, 
    columns = c(DDreligion_Senior,
                pct_4_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(`DDeconomic_First Year`,
                pct_1_fy,
                `DDpolitical_First Year`,
                pct_2_fy,
                `DDrace_First Year`,
                pct_3_fy,
                `DDreligion_First Year`,
                pct_4_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(DDeconomic_Senior,
                pct_1_sr,
                DDpolitical_Senior,
                pct_2_sr,
                DDrace_Senior,
                pct_3_sr,
                DDreligion_Senior,
                pct_4_sr),
    level = 2
  ) %>% 
  cols_move(columns = c(`DDeconomic_First Year`,
                                pct_1_fy,
                                `DDpolitical_First Year`,
                                pct_2_fy,
                                `DDrace_First Year`,
                                pct_3_fy,
                                `DDreligion_First Year`,
                                pct_4_fy),
            after = response) %>% 
  cols_label(response = "Response by Demographic",
             `DDeconomic_First Year` = "n",
             pct_1_fy = "%",
             `DDpolitical_First Year` = "n",
             pct_2_fy = "%",
             `DDrace_First Year` = "n",
             pct_3_fy = "%",
             `DDreligion_First Year` = "n",
             pct_4_fy  = "%",
             DDeconomic_Senior = "n",
             pct_1_sr = "%",
             DDpolitical_Senior = "n",
             pct_2_sr = "%",
             DDrace_Senior ="n",
             pct_3_sr = "%",
             DDreligion_Senior = "n",
             pct_4_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:18
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:18
    )
  ) %>%  
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")


# opt_table_font(font = google_font("Noto Sans Mono")) # how to change font for entire table

# fmt_pad_num(columns = contains("pct"), nsmall = 2) # how to decimal align percentages. Must use a mono font, which aren't easy to read. Result also appears oddly aligned
  
```

#### Quality of Interactions

```{r gt-dbell-summary-table-qi}

table_qi %>%
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Quality of Interactions",
             subtitle = "Indicate the quality of your interactions with the following people at University of Oregon.") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "Admin",
    id = 1,
    columns = c(3,
                pct_1_fy)
  ) %>%
  tab_spanner(
    label = "Advisors",
    id = 2,
    columns = c(5,
                pct_2_fy)
  ) %>%
  tab_spanner(
    label = "Faculty",
    id = 3,
    columns = c(7,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = "Student Services",
    id = 4, 
    columns = c(9,
                pct_4_fy)
  ) %>% 
  tab_spanner(
    label = "Students",
    id = 5, 
    columns = c(11,
                pct_5_fy)
  ) %>% 
  tab_spanner(
    label = "Admin",
    id = 6, 
    columns = c(4,
                pct_1_sr)
  ) %>% 
  tab_spanner(
    label = "Advisors",
    id = 7, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "Faculty",
    id = 8, 
    columns = c(8,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = "Student Services",
    id = 9, 
    columns = c(10,
                pct_4_sr)
  ) %>% 
  tab_spanner(
    label = "Students",
    id = 10, 
    columns = c(12,
                pct_5_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr,
                8,
                pct_3_sr,
                10,
                pct_4_sr,
                12,
                pct_5_sr),
    level = 2
  ) %>% 
  cols_move(
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy),
    after = response
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `QIstudent_First Year` = "n",
    pct_1_fy = "%",
    `QIadvisor_First Year` = "n",
    pct_2_fy = "%",
    `QIfaculty_First Year` = "n",
    pct_3_fy = "%",
    `QIstaff_First Year` = "n",
    pct_4_fy  = "%",
    `QIadmin_First Year` = "n",
    pct_5_fy = "%",
    QIstudent_Senior = "n",
    pct_1_sr = "%",
    QIadvisor_Senior = "n",
    pct_2_sr = "%",
    QIfaculty_Senior ="n",
    pct_3_sr = "%",
    QIstaff_Senior = "n",
    pct_4_sr = "%",
    QIadmin_Senior = "n",
    pct_5_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  c( `QIstudent_First Year`, QIstudent_Senior, 
                  `QIadvisor_First Year`, QIadvisor_Senior, 
                  `QIfaculty_First Year`, QIfaculty_Senior,
                  `QIstaff_First Year`, QIstaff_Senior,
                  `QIadmin_First Year`, QIadmin_Senior) 
  ) %>% 
    cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:22 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:22 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Supportive Environment

```{r gt-dbell-summary-table-se}

table_se %>%
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Supportive Environment",
             subtitle = "How much does your institution emphasize the following?") %>% 
  fmt_percent(starts_with("pct")) %>%
  tab_spanner(
    label = "Academic Success",
    id = 1,
    columns = c(3,
                pct_1_fy)
  ) %>%
  tab_spanner(
    label = "Campus Activities",
    id = 2,
    columns = c(5,
                pct_2_fy)
  ) %>%
  tab_spanner(
    label = "Diverse Interactions",
    id = 3,
    columns = c(7,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = "Social Justive Events",
    id = 4, 
    columns = c(9,
                pct_4_fy)
  ) %>% 
  tab_spanner(
    label = "Learning Support",
    id = 5, 
    columns = c(11,
                pct_5_fy)
  ) %>% 
  tab_spanner(
    label = "School/Life Balance",
    id = 6, 
    columns = c(13,
                pct_6_fy)
  ) %>% 
  tab_spanner(
    label = "Social Opportunities",
    id = 7, 
    columns = c(15,
                pct_7_fy)
  ) %>%     tab_spanner(
    label = "Well-Being",
    id = 8, 
    columns = c(17,
                pct_8_fy)
  ) %>%   
  tab_spanner(
    label = "Academic Success",
    id = 9, 
    columns = c(4,
                pct_1_sr)
  ) %>% 
  tab_spanner(
    label = "Campus Activities",
    id = 10, 
    columns = c(6,
                pct_2_sr
    )
  ) %>%  
  tab_spanner(
    label = "Diverse Interactions",
    id = 11, 
    columns = c(8,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = "Social Justice Events",
    id = 12, 
    columns = c(10,
                pct_4_sr)
  ) %>% 
  tab_spanner(
    label = "Learning Support",
    id = 13, 
    columns = c(12,
                pct_5_sr)
  ) %>% 
  tab_spanner(
    label = "School/Life Balance",
    id = 14, 
    columns = c(14,
                pct_6_sr)
  ) %>% 
  tab_spanner(
    label = "Social Opportunities",
    id = 15, 
    columns = c(16,
                pct_7_sr)
  ) %>%     tab_spanner(
    label = "Well-Being",
    id = 16, 
    columns = c(18,
                pct_8_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy,
                13,
                pct_6_fy,
                15,
                pct_7_fy,
                17,
                pct_8_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr,
                8,
                pct_3_sr,
                10,
                pct_4_sr,
                12,
                pct_5_sr,
                14,
                pct_6_sr,
                16,
                pct_7_sr,
                18,
                pct_8_sr),
    level = 2
  ) %>% 
  cols_move(
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy, 
                13,
                pct_6_fy,
                15,
                pct_7_fy,
                17,
                pct_8_fy),
    after = response
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `SEacademic_First Year` = "n",
    pct_1_fy = "%",
    `SElearnsup_First Year` = "n",
    pct_2_fy = "%",
    `SEdiverse_First Year` = "n",
    pct_3_fy = "%",
    `SEsocial_First Year` = "n",
    pct_4_fy  = "%",
    `SEwellness_First Year` = "n",
    pct_5_fy = "%",
    `SEnonacad_First Year` = "n",
    pct_6_fy= "%",
    `SEactivities_First Year` = "n",
    pct_7_fy= "%",
    `SEevents_First Year` = "n",
    pct_8_fy= "%",
    SEacademic_Senior = "n",
    pct_1_sr = "%",
    SElearnsup_Senior = "n",
    pct_2_sr = "%",
    SEdiverse_Senior ="n",
    pct_3_sr = "%",
    SEsocial_Senior = "n",
    pct_4_sr = "%",
    SEwellness_Senior = "n",
    pct_5_sr = "%",
    SEnonacad_Senior = "n",
    pct_6_sr= "%",
    SEactivities_Senior = "n",
    pct_7_sr= "%",
    SEevents_Senior = "n",
    pct_8_sr= "%"
  ) %>% 
    cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns = 3:34 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:34 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(78)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Reflective and Integrative Learning

```{r gt-dbell-summary-table-ri}

table_ri %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>% 
  tab_header(title = "Reflective & Integrative Learning",
             subtitle = "During the current school year, how often have you done the following?") %>% 
  fmt_percent(starts_with("pct")) %>% 
  tab_spanner(
    label = "Included Diverse Perspectives in Coursework",
    id = 1, 
    columns = c(3,
                pct_1_fy)
  ) %>% 
  tab_spanner(
    label = "Connected Learning to Societal Issues",
    id = 2, 
    columns = c(5,
                pct_2_fy)
  ) %>% 
  tab_spanner(
    label = "Included Diverse Perspectives in Coursework",
    id = 3, 
    columns = c(4,
                pct_1_sr)
  )  %>% 
  tab_spanner(
    label = "Connected Learning to Societal Issues",
    id = 4, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr),
    level = 2
  ) %>% 
  cols_move(columns = c(3,
                        pct_1_fy,
                        5,
                        pct_2_fy),
            after = response) %>% 
  cols_label(response = "Response by Demographic",
             `RIsocietal_First Year` = "n",
             pct_1_fy = "%",
             `RIdiverse_First Year` = "n",
             pct_2_fy = "%",
             RIsocietal_Senior = "n",
             pct_1_sr = "%",
             RIdiverse_Senior = "n",
             pct_2_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:10 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:10 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### High-Impact Practices

```{r gt-dbell-summary-table-hip}

table_hip %>%
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "High Impact Practices",
             subtitle = "Which of the following have you done while in college or do you plan to do before you graduate?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "Hold a Leadership Role in a Student Organization",
    id = 1,
    columns = c(3,
                pct_1_fy)
  ) %>%
  tab_spanner(
    label = "Participate in a Learning Community",
    id = 2,
    columns = c(5,
                pct_2_fy)
  ) %>%
  tab_spanner(
    label = "Work with Faculty on a Research Project",
    id = 3,
    columns = c(7,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = "Hold a Leadership Role in a Student Organization",
    id = 6, 
    columns = c(4,
                pct_1_sr)
  ) %>% 
  tab_spanner(
    label = "Participate in a Learning Community",
    id = 7, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "Work with Faculty on a Research Project",
    id = 8, 
    columns = c(8,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr,
                8,
                pct_3_sr),
    level = 2
  ) %>% 
  cols_move(
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy),
    after = response
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `leader_First Year` = "n",
    pct_1_fy = "%",
    `learncom_First Year` = "n",
    pct_2_fy = "%",
    `research_First Year` = "n",
    pct_3_fy = "%",
    leader_Senior = "n",
    pct_1_sr = "%",
    learncom_Senior = "n",
    pct_2_sr = "%",
    research_Senior ="n",
    pct_3_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:14 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:14 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Perceived Gains: Speaking

```{r gt-dbell-summary-table-pgspeak}

table_pgspeak %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Perceived Gains in Verbal Communication",
             subtitle = "How much has your experience at the University of Oregon contributed to your knowledge, skills, and personal development speaking clearly and effectively?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "First Year",
    id = 1,
    columns = c(3,
                5)
  ) %>%
  tab_spanner(
    label = "Senior",
    id = 2,
    columns = c(4,
                6)
  ) %>%
  cols_move(
    columns = 5,
    after = 3
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `First Year` = "n",
    pct_fy = "%",
    `Senior` = "n",
    pct_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:6 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      3:6 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Sense of Belonging

```{r gt-dbell-summary-table-sb}

table_sbvalued %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Sense of Belonging",
             subtitle = "To what extent do you agree or disagree with feeling valued by the University of Oregon?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "First Year",
    id = 1,
    columns = c(3,
                5)
  ) %>%
  tab_spanner(
    label = "Senior",
    id = 2,
    columns = c(4,
                6)
  ) %>%
  cols_move(
    columns = 5,
    after = 3
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `First Year` = "n",
    pct_fy = "%",
    `Senior` = "n",
    pct_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:6 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      3:6 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")


```

#### Academic Challenge: Reading

```{r gt-dbell-summary-table-reading}

table_reading %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Academic Challenge: Reading",
             subtitle = "Of the time you spend preparing for class in a typical 7-day week, about how much is on assigned reading?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "First Year",
    id = 1,
    columns = c(3,
                5)
  ) %>%
  tab_spanner(
    label = "Senior",
    id = 2,
    columns = c(4,
                6)
  ) %>%
  cols_move(
    columns = 5,
    after = 3
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `First Year` = "n",
    pct_fy = "%",
    `Senior` = "n",
    pct_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:6 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      3:6 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Academic Challenge: Course Presentations

```{r gt-dbell-summary-table-present}

table_present %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Academic Challenge: In-Class Presentations",
             subtitle = "During the current school year, about how often have you given a course presentation?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "First Year",
    id = 1,
    columns = c(3,
                5)
  ) %>%
  tab_spanner(
    label = "Senior",
    id = 2,
    columns = c(4,
                6)
  ) %>%
  cols_move(
    columns = 5,
    after = 3
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `First Year` = "n",
    pct_fy = "%",
    `Senior` = "n",
    pct_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:6 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      3:6 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Career Plans

```{r gt-dbell-summary-table-cwp-plans}

table_cwp_plans %>%
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Career Plans",
             subtitle = "To what extent does the following apply to you?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = html("Experience at <br> UO Helped <br> Clarify Plans"),
    id = 1,
    columns = c(3,
                pct_1_fy)
  ) %>%
  tab_spanner(
    label = "Able to Describe Knowl./Skills/Exp. Needed for Plans",
    id = 2,
    columns = c(5,
                pct_2_fy)
  ) %>%
  tab_spanner(
    label = "Supp. Feedback from Faculty/Adv. About Plans",
    id = 3,
    columns = c(7,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = html("Have a <br> Clear Idea <br> of Plans"),
    id = 4, 
    columns = c(9,
                pct_4_fy)
  ) %>% 
  tab_spanner(
    label = html("Learning at <br> UO is Relevant <br> to Plans"),
    id = 5, 
    columns = c(11,
                pct_5_fy)
  ) %>% 
  tab_spanner(
    label = html("Experience at <br> UO Helped <br> Clarify Plans"),
    id = 6, 
    columns = c(4,
                pct_1_sr)
  ) %>% 
  tab_spanner(
    label = "Able to Describe Knowl./Skills/Exp. Needed for Plans",
    id = 7, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "Supp. Feedback from Faculty/Adv. About Plans",
    id = 8, 
    columns = c(8,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = html("Have a <br> Clear Idea <br> of Plans"),
    id = 9, 
    columns = c(10,
                pct_4_sr)
  ) %>% 
  tab_spanner(
    label = html("Learning at <br> UO is Relevant <br> to Plans"),
    id = 10, 
    columns = c(12,
                pct_5_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr,
                8,
                pct_3_sr,
                10,
                pct_4_sr,
                12,
                pct_5_sr),
    level = 2
  ) %>% 
  cols_move(
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy),
    after = response
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `CWPclarify_First Year` = "n",
    pct_1_fy = "%",
    `CWPdescribe_First Year` = "n",
    pct_2_fy = "%",
    `CWPfeedback_First Year` = "n",
    pct_3_fy = "%",
    `CWPidea_First Year` = "n",
    pct_4_fy  = "%",
    `CWPrelevant_First Year` = "n",
    pct_5_fy = "%",
    CWPclarify_Senior = "n",
    pct_1_sr = "%",
    CWPdescribe_Senior = "n",
    pct_2_sr = "%",
    CWPfeedback_Senior ="n",
    pct_3_sr = "%",
    CWPidea_Senior = "n",
    pct_4_sr = "%",
    CWPrelevant_Senior = "n",
    pct_5_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  c(`CWPidea_First Year`, CWPidea_Senior, 
                 `CWPclarify_First Year`, CWPclarify_Senior, 
                 `CWPrelevant_First Year`, CWPrelevant_Senior,
                 `CWPdescribe_First Year`, CWPdescribe_Senior,
                 `CWPfeedback_First Year`, CWPfeedback_Senior) 
  ) %>% 
    cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:22 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:22 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Influences on Career Plans

```{r gt-dbell-summary-table-cwp-influences}

table_cwp_inf %>%
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Career Plans",
             subtitle = "To what extent have the following influenced your career plans?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "Interactions with Faculty or Academic Advisor",
    id = 1,
    columns = c(3,
                pct_1_fy)
  ) %>%
  tab_spanner(
    label = "Interactions with Career Coach or Career Advisor",
    id = 2,
    columns = c(5,
                pct_2_fy)
  ) %>%
  tab_spanner(
    label = html("<br> Co-curricular Activities"),
    id = 3,
    columns = c(7,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = html("Advice from Family or <br> Friends"),
    id = 4, 
    columns = c(9,
                pct_4_fy)
  ) %>% 
  tab_spanner(
    label = "Advice from High School Teacher or Counselor",
    id = 5, 
    columns = c(11,
                pct_5_fy)
  ) %>% 
  tab_spanner(
    label = "Interactions with Faculty or Academic Advisor",
    id = 6, 
    columns = c(4,
                pct_1_sr)
  ) %>% 
  tab_spanner(
    label = "Interactions with Career Coach or Career Advisor",
    id = 7, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = html("<br> Co-curricular Activities"),
    id = 8, 
    columns = c(8,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = html("Advice from Family or <br> Friends"),
    id = 9, 
    columns = c(10,
                pct_4_sr)
  ) %>% 
  tab_spanner(
    label = "Advice from High School Teacher or Counselor",
    id = 10, 
    columns = c(12,
                pct_5_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr,
                8,
                pct_3_sr,
                10,
                pct_4_sr,
                12,
                pct_5_sr),
    level = 2
  ) %>% 
  cols_move(
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy,
                9,
                pct_4_fy,
                11,
                pct_5_fy),
    after = response
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `CWPadvisor_First Year` = "n",
    pct_1_fy = "%",
    `CWPcoach_First Year` = "n",
    pct_2_fy = "%",
    `CWPcocurrR_First Year` = "n",
    pct_3_fy = "%",
    `CWPfamily_First Year` = "n",
    pct_4_fy  = "%",
    `CWPhighschool_First Year` = "n",
    pct_5_fy = "%",
    CWPadvisor_Senior = "n",
    pct_1_sr = "%",
    CWPcoach_Senior = "n",
    pct_2_sr = "%",
    CWPcocurrR_Senior ="n",
    pct_3_sr = "%",
    CWPfamily_Senior = "n",
    pct_4_sr = "%",
    CWPhighschool_Senior = "n",
    pct_5_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  c(`CWPfamily_First Year`, CWPfamily_Senior, 
                 `CWPhighschool_First Year`, CWPhighschool_Senior, 
                 `CWPadvisor_First Year`, CWPadvisor_Senior,
                 `CWPcoach_First Year`, CWPcoach_Senior,
                 `CWPcocurrR_First Year`, CWPcocurrR_Senior) 
  ) %>% 
    cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:22 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:22 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Career Research

```{r gt-dbell-summary-table-cwp-research}

table_cwp_research %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Career Research",
             subtitle = "In your courses at University of Oregon, about how often have you researched a career interest, a potential employer, or the job market?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "First Year",
    id = 1,
    columns = c(3,
                5)
  ) %>%
  tab_spanner(
    label = "Senior",
    id = 2,
    columns = c(4,
                6)
  ) %>%
  cols_move(
    columns = 5,
    after = 3
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `First Year` = "n",
    pct_fy = "%",
    `Senior` = "n",
    pct_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:6 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      3:6 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Civic Engagement Encouragement

```{r gt-dbell-summary-table-civ-encourgement}

table_civ_enc %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>% 
  tab_header(title = "Civic Engagement Encouragement",
             subtitle = "How much do you feel encouraged addressing important social, economic, or political issues in the following? ") %>% 
  fmt_percent(starts_with("pct")) %>% 
  tab_spanner(
    label = "Course Assignments",
    id = 1, 
    columns = c(3,
                pct_1_fy)
  ) %>% 
  tab_spanner(
    label = "Course Discussions",
    id = 2, 
    columns = c(5,
                pct_2_fy)
  ) %>% 
  tab_spanner(
    label = "Course Assignments",
    id = 3, 
    columns = c(4,
                pct_1_sr)
  )  %>% 
  tab_spanner(
    label = html("Course <br> Discussions"),
    id = 4, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr),
    level = 2
  ) %>% 
  cols_move(columns = c(3,
                        pct_1_fy,
                        5,
                        pct_2_fy),
            after = response
  ) %>% 
  cols_label(response = "Response by Demographic",
             `CIV03a19_First Year` = "n",
             pct_1_fy = "%",
             `CIV03b19_First Year` = "n",
             pct_2_fy = "%",
             CIV03a19_Senior = "n",
             pct_1_sr = "%",
             CIV03b19_Senior = "n",
             pct_2_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:10 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:10 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Civic Engagement Campus and Local Issues

```{r gt-dbell-summary-table-civ-localissues}

table_civ_loc %>%
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Civic Engagement: Campus and Local Issues",
             subtitle = "During the current school year, whether course-related or not, about how often have you done the following? ") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "Informed Self About Campus/Local Issues",
    id = 1,
    columns = c(3,
                pct_1_fy)
  ) %>%
  tab_spanner(
    label = html("Discussed Campus/Local Issues with <br> Others"),
    id = 2,
    columns = c(5,
                pct_2_fy)
  ) %>%
  tab_spanner(
    label = "Organized Others to Work on Campus/Local Issues",
    id = 3,
    columns = c(7,
                pct_3_fy)
  ) %>% 
  tab_spanner(
    label = "Informed Self About Campus/Local Issues",
    id = 6, 
    columns = c(4,
                pct_1_sr)
  ) %>% 
  tab_spanner(
    label =  html("Discussed Campus/Local Issues with <br> Others"),
    id = 7, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "Organized Others to Work on Campus/Local Issues",
    id = 8, 
    columns = c(8,
                pct_3_sr)
  ) %>% 
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr,
                8,
                pct_3_sr),
    level = 2
  ) %>% 
  cols_move(
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy,
                7,
                pct_3_fy),
    after = response
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `CIV04a19_First Year` = "n",
    pct_1_fy = "%",
    `CIV04c19_First Year` = "n",
    pct_2_fy = "%",
    `CIV04i19_First Year` = "n",
    pct_3_fy = "%",
    CIV04a19_Senior = "n",
    pct_1_sr = "%",
    CIV04c19_Senior = "n",
    pct_2_sr = "%",
    CIV04i19_Senior ="n",
    pct_3_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:14 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:14 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Civic Engagement Conflict Resolution

```{r gt-dbell-summary-table-civ-conflict-res}

table_civ_conf %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>% 
  tab_header(title = "Civic Engagement: Conflict Resolution",
             subtitle = "Select the response that best represents your ability to do the following. ") %>% 
  fmt_percent(starts_with("pct")) %>% 
  tab_spanner(
    label = "Help People Resolve Disagreements with Each Other",
    id = 1, 
    columns = c(3,
                pct_1_fy)
  ) %>% 
  tab_spanner(
    label = "Resolve Conflicts Involving Bias, Discrimination, and Prejudice",
    id = 2, 
    columns = c(5,
                pct_2_fy)
  ) %>% 
  tab_spanner(
    label =  "Help People Resolve Disagreements with Each Other",
    id = 3, 
    columns = c(4,
                pct_1_sr)
  )  %>% 
  tab_spanner(
    label =  "Resolve Conflicts Involving Bias, Discrimination, and Prejudice",
    id = 4, 
    columns = c(6,
                pct_2_sr)
  ) %>%  
  tab_spanner(
    label = "First Year",
    columns = c(3,
                pct_1_fy,
                5,
                pct_2_fy),
    level = 2
  ) %>%  
  tab_spanner(
    label = "Senior",
    columns = c(4,
                pct_1_sr,
                6,
                pct_2_sr),
    level = 2
  ) %>% 
  cols_move(columns = c(3,
                        pct_1_fy,
                        5,
                        pct_2_fy),
            after = response
  ) %>% 
  cols_label(response = "Response by Demographic",
             `CIV01a19_First Year` = "n",
             pct_1_fy = "%",
             `CIV01b19_First Year` = "n",
             pct_2_fy = "%",
             CIV01a19_Senior = "n",
             pct_1_sr = "%",
             CIV01b19_Senior = "n",
             pct_2_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:10 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
     3:10 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

#### Civic Engagement Institutional Emphasis 

```{r gt-dbell-summary-table-civ-inst-emphasis}

table_civ_inst %>% 
  gt(groupname_col = "demo",
     rowname_col = "rowname") %>%
  tab_header(title = "Civic Engagement: Institutional Emphasis",
             subtitle = "How much does University of Oregon emphasize being an informed and active citizen?") %>% 
  fmt_percent(starts_with("pct")
  ) %>%
  tab_spanner(
    label = "First Year",
    id = 1,
    columns = c(3,
                5)
  ) %>%
  tab_spanner(
    label = "Senior",
    id = 2,
    columns = c(4,
                6)
  ) %>%
  cols_move(
    columns = 5,
    after = 3
  ) %>% 
  cols_label(
    response = "Response by Demographic",
    `First Year` = "n",
    pct_fy = "%",
    `Senior` = "n",
    pct_sr = "%"
  ) %>% 
  cols_align(
    align = "right",
    columns = response
  ) %>% 
  cols_align(
    align = "center",
    columns =  3:6 
  ) %>% 
  tab_style(
    style = cell_text(align = "left"), 
    locations = cells_column_labels()
  ) %>% 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(
      3:6 
    )
  ) %>% 
  cols_width(
    response ~ px(150),
    everything() ~ px(70)
  ) %>% 
  opt_align_table_header(align = "left")

```

### Part I: Diverging Stacked Likert Bar Graphs

#### Discussions w/ Diverse Others (Gender x Class)

```{r}
dd_gender_fy <- nsse_idr_wide_fct %>% 
  select(IRsex19, 
         IRclass, 
         DDrace, 
         DDeconomic, 
         DDreligion, 
         DDpolitical) %>% 
  filter(IRsex19 != "Unknown" & 
           IRclass == "First Year") %>% 
  rename(
    "Race/ethnicity" = DDrace,
    "SES" = DDeconomic,
    "Religious beliefs" = DDreligion,
    "Political ideology" = DDpolitical) %>% as.data.frame() 

str(dd_gender_fy)

dd_gender_sr <- nsse_idr_wide_fct %>% 
  select(IRsex19, 
         IRclass, 
         DDrace, 
         DDeconomic, 
         DDreligion, 
         DDpolitical) %>% 
  filter(IRsex19 != "Unknown" & 
           IRclass == "Senior") %>% 
  rename(
    "Race/ethnicity" = DDrace,
    "SES" = DDeconomic,
    "Religious beliefs" = DDreligion,
    "Political ideology" = DDpolitical) %>% as.data.frame() 

likdata <- likert(dd_gender_fy[,3:6], grouping = dd_gender_fy$IRsex19)

likdata2 <- likert(dd_gender_sr[,3:6], grouping = dd_gender_sr$IRsex19)

plot(likdata, type = "bar") + 
  labs(title = "Discussions with Diverse Others: First Year Students by Gender",
       subtitle = "During the current school year, how often have you had discussions with those differing in...?") + 
  theme(legend.title = element_blank())

plot(likdata2, type = "bar") + 
  labs(title = "Discussions with Diverse Others: Senior Students by Gender",
       subtitle = "During the current school year, how often have you had discussions with those differing in...?") + 
  theme(legend.title = element_blank(),
        panel.grid = element_blank()) 
    
    # "Students" = QIstudent,
    # "Advisors" = QIadvisor,
    # "Faculty" = QIfaculty,
    # "Student services" = QIstaff,
    # "Admin" = QIadmin,
    # "Support for succeeding academically" = SEacademic,
    # "Using learning support services" = SElearnsup,
    # "Encouraging diverse interactions" = SEdiverse,
    # "Opportunities for social inolvement" = SEsocial,
    # "Support for well-being" = SEwellness,
    # "Help managing work/school/life balance" = SEnonacad,
    # "Attending campus activities/events" = SEactivities,
    # "Attending social justice events" = SEevents,
    # "Given a course presentation" = present,
    # "Connected learning to societal problems or issues" = RIsocietal,
    # "Included diverse perspectives in course discussions or assignments" = RIdiverse,
    # "Hold a leadership role in a student organization/group" = leader,
    # "Work with faculty on a research project" = research,                                        # "Participate in a learning community" = learncom
```

